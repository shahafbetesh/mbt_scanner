<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>סורק נוכחות</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 90vh; background-color: #f4f4f9; color: #333; }
        #container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; width: 90%; max-width: 400px; }
        h1 { color: #4a4a4a; }
        input, button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
        button { background-color: #007aff; color: white; font-weight: bold; border: none; cursor: pointer; transition: background-color 0.2s; }
        button:disabled { background-color: #aaa; }
        #reader { width: 100%; margin-top: 20px; border-radius: 8px; overflow: hidden; display: none; }
        #result { margin-top: 20px; font-weight: bold; min-height: 40px; color: #28a745; }
    </style>
</head>
<body>
    <div id="container">
        <h1>סורק נוכחות</h1>
        <input type="text" id="sessionName" placeholder="רשום את שם המפגש (למשל, מפגש-2)">
        <button id="startButton">התחל סריקה</button>
        <div id="reader"></div>
        <div id="result"></div>
    </div>

    <!-- The QR scanner library (appears only ONCE) -->
    <script>
    !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Html5Qrcode={})}(this,function(e){"use strict";var t,r={facingMode:"user",zoom:0},n={fps:10,qrbox:250,aspectRatio:1.7777778,disableFlip:!1,videoConstraints:r};function i(e){return e||(n.fps=10,n.qrbox=250,n.aspectRatio=1.7777778,n.disableFlip=!1,n.videoConstraints=r),{fps:e.fps||n.fps,disableFlip:!!e.disableFlip,qrbox:e.qrbox||n.qrbox,aspectRatio:e.aspectRatio||n.aspectRatio,videoConstraints:e.videoConstraints||n.videoConstraints}}var o,s,a;function c(e){var t;return(t=e,!!(t.id||t.deviceId))?e.id?e.id:e.deviceId:e}function u(e){return"string"==typeof e}function l(e){return"function"==typeof e}(t||(t={})).QR_CODE="qr_code",(o||(o={})).AZTEC="aztec",(o||(o={})).CODABAR="codabar",(o||(o={})).CODE_39="code_39",(o||(o={})).CODE_93="code_93",(o||(o={})).CODE_128="code_128",(o||(o={})).DATA_MATRIX="data_matrix",(o||(o={})).MAXICODE="maxicode",(o||(o={})).ITF="itf",(o||(o={})).EAN_13="ean_13",(o||(o={})).EAN_8="ean_8",(o||(o={})).PDF_417="pdf_417",(o||(o={})).RSS_14="rss_14",(o||(o={})).RSS_EXPANDED="rss_expanded",(o||(o={})).UPC_A="upc_a",(o||(o={})).UPC_E="upc_e",(o||(o={})).UPC_EAN_EXTENSION="upc_ean_extension",(s||(s={})).PORTRAIT="portrait",(s||(s={})).LANDSCAPE="landscape",(a||(a={})).ERROR="error",a.WARNING="warning",a.INFO="info";class d{constructor(e,t){this.format=e,this.type=t}static create(e){const r=e.split(",");if(1==r.length)return"qr_code"===r[0]?new d(t.QR_CODE,"code"):new d(o[r[0]],"code");{const e=[],t=[];for(const n of r)"qr_code"===n?e.push(n):t.push(o[n]);if(0!==e.length&&0!==t.length)throw"The decoder library doesn't support mixing QR code with other formats.";return 0!==t.length?new d(t,"code"):new d(e,"code")}}}class h{constructor(e,t){this.data=e,this.decodedText=t}static create(e,t){const r=[];for(const n of e)r.push(new h(n.rawValue,n.format));return r}}class p{constructor(e){this.message=e,this.name="UnsupportedOperationException"}toString(){return`${this.name}: ${this.message}`}}function m(e){return e.LuminanceSource?e:e.default?e.default:e}function f(e){return e.BinaryBitmap?e:e.default?e.default:e}function g(e){return e.Result?e:e.default?e.default:e}function _(e){return e.DecodeHintType?e:e.default?e.default:e}function v(e){return e.MultiFormatReader?e:e.default?e.default:e}class b{constructor(e,t){if(!t)throw"Use Html5Qrcode.getCameras() to get list of cameras.";this.format=d.create(e),this.verbose=t,this.decoder=null}scan(e,t,r,n){return this.scanAsync(e,t,r,n)}async scanAsync(e,t,r,n){if(!r||!l(r))throw"successCallback is required callback.";if(n&&!l(n))throw"errorCallback is required callback.";const o=this;return o.decoder||await this.initializeDecoder(),new Promise((s,a)=>{o.decoder.scan(e,t,e=>{const t=h.create(e,o.verbose);r(t.decodedText,t)},e=>{"string"==typeof e&&-1!==e.indexOf("NotFoundException")?n&&n("QR code not found."):n&&n(e)}).then(e=>{s(e)}).catch(e=>{a(e)})})}async initializeDecoder(){if(this.format.type,this.format.format,this.decoder)return;const e=this.verbose;if(!window.ZXing)throw"Use html5-qrcode.min.js without edit, ZXing not found.";const t=await window.ZXing,r=new Map;if(e&&console.log("ZXing library loaded"),this.format.format===d.QR_CODE.format){const n=new t.MultiFormatReader(e);r.set(_(t).TRY_HARDER,e),r.set(_(t).POSSIBLE_FORMATS,[g(t).QR_CODE]);n.setHints(r);const i=new Map;i.set("need_result_point_callbacks",!1),n.setNeedResultPointCallback(i);const s=this;this.decoder={scan:async(r,n,a,c)=>{const u=new Image;u.onload=()=>{try{const r=u.width,n=u.height;let c;if(o.isScanning){const t=document.createElement("canvas");t.width=r,t.height=n;const i=t.getContext("2d",{willReadFrequently:!0});i.drawImage(u,0,0,r,n),c=i.getImageData(0,0,r,n)}else c=void 0;if(!c)return void a("image load failed");const d=new(m(t).default)(c.data,r,n),h=new(f(t).default)(new(t.HybridBinarizer)(d)),p=n.decode(h,i);a(p.getText())}catch(e){c(e),e}};const o=s;u.onerror=c,u.onabort=c,u.src=r}};const s=this;return new Promise(t=>{s.decoder.scan().then(()=>{}).catch(()=>{}),t()})}}throw new p(`format ${this.format} not supported.`)}}{constructor(e){this.logger=e}log(e){this.logger.log(e)}warn(e){this.logger.warn(e)}error(e){this.logger.error(e)}}var y="https-qrcode";function w(e,t,r){const n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.background="rgba(255, 255, 255, 0.6)",n.style.width="100%",n.style.height="100%",n.style.display="flex",n.style.justifyContent="center",n.style.alignItems="center";const i=document.createElement("div");i.style.width=`${e}px`,i.style.height=`${t}px`,i.style.background="white",i.style.border=`${r}px solid #32CD32`,i.style.borderRadius="10px";const o=document.createElement("div");o.style.width=`${e-2*r}px`,o.style.height=`${t-2*r}px`,o.style.border="4px dashed #32CD32",o.style.borderRadius="7px",i.appendChild(o),n.appendChild(i);const s=document.createElement("div");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.zIndex=1,s.appendChild(n);const a=document.createElement("div");return a.style.position="relative",a.style.width="100%",a.style.height="100%",a.appendChild(s),{container:a,banner:n,qrbox:i,closeButton:void 0}}function C(e,t,r){let n,i=1,o=1;const s=(e,t)=>{n=document.getElementById(e),i=n.offsetWidth,o=n.offsetHeight};if(s(e,!0),"number"==typeof t)n.style.width=`${t}px`;else{const e=t.width,r=t.height;if(e&&r)throw"The qrbox config cannot have both width and height defined.";if(e)n.style.width=`${e}px`;else{if(!r)throw"The qrbox config must have at least width or height defined.";n.style.width=`${r*i/o}px`}}if(r)n.style.height=`${n.offsetWidth/r}px`;else{const e=t.width,r=t.height;if(!e&&r)n.style.height=`${r}px`;else{if(!e)return;const t=n.offsetWidth;n.style.height=`${t*o/i}px`}}}class S{constructor(e,t,r){this.elementId=e,this.verbose=t,this.logger=new b(r?r:console),this.shouldScan=e,this.isScanning=!1,this._initExisitingIfAny()}static async getCameras(){if(navigator.mediaDevices)return new Promise((e,t)=>{navigator.mediaDevices.enumerateDevices().then(t=>{const r=[];for(const n of t)"videoinput"===n.kind&&r.push({id:n.deviceId,label:n.label});e(r)}).catch(e=>{t(e)})});t([])}_getScanRegion(e,t){const r=document.getElementById(this.elementId);if(!r)throw`HTML Element with id=${this.elementId} not found`;const n={x:0,y:0,width:e,height:t};return n.width=r.clientWidth?r.clientWidth:n.width,n.height=r.clientHeight?r.clientHeight:n.height,{x:n.x,y:n.y,width:n.width,height:n.height}}_getShadedRegionBounds(e,t){const r=document.getElementById(this.elementId);if(!r)throw`HTML Element with id=${this.elementId} not found`;const n=r.getBoundingClientRect();return{x:n.left,y:n.top,width:n.width,height:n.height}}_setupVideo(e){const t=document.createElement("video");return t.style.width="100%",t.style.height="100%",t.autoplay=!0,t.playsInline=!0,t.muted=!0,t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.zIndex="0",e&&!1===e.disableFlip&&(t.style.transform="scaleX(-1)"),t}_clearElement(){const e=document.getElementById(this.elementId);if(e){for(;e.lastChild;)e.removeChild(e.lastChild);return!0}return!1}async start(e,t,r,n){if(!this.shouldScan)throw"Cannot start scanning, scanner has been stopped.";if(!e)throw"cameraIdOrConfig is required";if(!r||!l(r))throw"qrCodeSuccessCallback is required callback.";if(this.isScanning)throw"Scanning is already in progress, stop it first.";if(n&&!l(n))throw"qrCodeErrorCallback is required callback.";const o=i(t);this._clearElement();const s=document.getElementById(this.elementId);if(!s)throw`HTML Element with id=${this.elementId} not found`;this.currentScanConfig=o,this.qrCodeSuccessCallback=r,this.qrCodeErrorCallback=n;const a=this.currentScanConfig.videoConstraints;"object"!=typeof a&&(a={});const d=u(e);let h,p,m;if(d){const t=Object.assign({},a);t.deviceId={exact:c(e)},m=t}else{const t=e,r=Object.assign({},a);t.aspectRatio&&(r.aspectRatio=t.aspectRatio),t.facingMode&&(r.facingMode=t.facingMode),t.deviceId&&(r.deviceId=t.deviceId),m=r}return new Promise((e,t)=>{this.localMediaStream?e():(this.shouldScan||t("Scanner stopped forcefully."),navigator.mediaDevices.getUserMedia({video:m}).then(r=>{this.localMediaStream=r,h=this._setupVideo(o),p=s.attachShadow({mode:"open"}),s.style.position="relative",s.style.overflow="hidden",p.appendChild(h),e()}).catch(e=>{t(`Error getting user media: ${e}`)}))}).then(()=>{this.isScanning=!0,this.videoElement=h,this.videoElement.srcObject=this.localMediaStream;const e=this.videoElement.style;e.width="100%",e.height="100%",e.objectFit="cover",this.videoElement.play(),this._possiblySetupQrbox(o),this._scan(o)})}_possiblySetupQrbox(e){if(e.qrbox){const t=u(e.qrbox)?parseInt(e.qrbox,10):e.qrbox;if("number"!=typeof t&&("object"!=typeof t||!t.width&&!t.height))throw`Invalid instance of QrDimensions passed for qrbox, expected 'number' or instance of QrDimensions with width or height defined.`;if(e.aspectRatio&&("number"!=typeof t||t>Math.min(this.videoElement.videoWidth,this.videoElement.videoHeight)))throw`Invalid qrbox size passed, staisfying aspect ratio not possible.`;const r=w(300,300,5);this.shadedRegionElement=r.container,this.domElement.shadowRoot.appendChild(this.shadedRegionElement);const n=this.domElement.shadowRoot.getElementById(y);C(y,t,e.aspectRatio),this.qrboxRegion=n.getBoundingClientRect()}}stop(){if(!this.shouldScan)return this.logger.log("Scan is not in progress."),Promise.resolve();if(this.localMediaStream){const e=this.localMediaStream.getVideoTracks();for(const t of e)t.stop()}return this.shouldScan=!1,this.isScanning=!1,this.videoElement&&this.videoElement.srcObject?this.videoElement.srcObject=null:this.logger.log("No video element found to remove srcObject from."),this._clearElement(),Promise.resolve()}async scan(){if(this.isScanning){if(!this.videoElement)return;if(this.videoElement.paused||this.videoElement.ended)return;const e=this.videoElement.videoWidth/this.videoElement.videoHeight,t=this.currentScanConfig;let r;if(t.aspectRatio)r=t.aspectRatio;else{const n=this.videoElement.getBoundingClientRect();r=n.width/n.height}const n=Math.floor(this.videoElement.videoWidth),i=Math.floor(this.videoElement.videoHeight),o=this._getScanRegion(n,i),s=this._createCanvasElement(o.width,o.height);s.getContext("2d",{willReadFrequently:!0}).drawImage(this.videoElement,0,0,o.width,o.height);try{if(!window.ZXing)return void this.logger.log("ZXing not found, delaying scanning");const a=await window.ZXing;if(!a.BrowserQRCodeReader)return void this.logger.log("BrowserQRCodeReader not found, delaying scanning.");const c=new a.BrowserQRCodeReader,u=c.decode(s);this.qrCodeSuccessCallback(u.text,u)}catch(e){if(this.qrCodeErrorCallback)this.qrCodeErrorCallback(e);else{const t="
